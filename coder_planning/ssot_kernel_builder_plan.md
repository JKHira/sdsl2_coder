Scope: Plan for SSOT kernel (definitions/runtime) authoring and L2 integration for distribution boundary JSON and registries.
Non-scope: Implementing the kernel, modifying existing tools, editing specs, or changing current L0/L1/L2 artifacts.

Definitions
- SSOT Kernel Definitions: const data, types, enums, interfaces only.
- SSOT Kernel Runtime: runtime functions, guards, builders, validators only.
- Distribution Boundary: OUTPUT/ssot/ssot_definitions.json (canonical JSON).
- Registry Map: OUTPUT/ssot/ssot_registry_map.json (SSOT.* -> target).

Rules
- Definitions MUST be separate from runtime; runtime MUST import definitions and MUST NOT redefine constants/types.
- SSOT Kernel MUST NOT depend on SDSL2 artifacts or decisions.
- Distribution Boundary JSON MUST be deterministic (UTF-8, LF, stable key/array order).
- Outputs MUST be written only under OUTPUT/ssot and MUST reject symlink/traversal.
- schema_version and source_rev MUST be present at the top level of ssot_definitions.json.
- Registry targets MUST use <path>#/<json_pointer> format and MUST resolve to the distribution boundary JSON.

---

## File Layout (Planned)
- ssot_kernel_builder/
  - ssot_definitions.ts (authoritative definitions; no runtime logic)
  - ssot_runtime.ts (runtime functions; imports from ssot_definitions.ts)
  - build_ssot_definitions.py (emit canonical JSON to OUTPUT/ssot/ssot_definitions.json)

- OUTPUT/ssot/
  - ssot_definitions.json (distribution boundary)
  - ssot_registry_map.json (SSOT.* mapping)
  - ssot_registry.json (generated by token_registry_gen)

---

## Definitions Plan (What to Encode)
- Core tokens used by Contract/Topology MUST be explicit (SSOT.*).
- Shared rules/constants (e.g., RBAC, modes, naming rules) MUST live in definitions.
- Public data types/interfaces used across services MUST be defined here.
- Versioning MUST be explicit (SSOT_META.version or equivalent) and mapped to schema_version in JSON.

Checklist
- [x] All exported definitions are const data/types/enums/interfaces only.
- [x] No runtime helpers in definitions.
- [x] All SSOT.* tokens referenced in SDSL appear in ssot_registry_map.json.

---


## SSOT Token Inventory (Current Usage)
Source: project_x/** and project_testing/** (excluding OUTPUT).

Tokens (sorted):
```
SSOT.ACCEPTANCE_CRITERIA
SSOT.ALERT_ACTIONS
SSOT.ALERT_CRITERIA
SSOT.API_GATEWAY_FLOW
SSOT.APPROVAL_POLICY
SSOT.ATOMICITY_CONSTRAINTS
SSOT.AUDIT_RETENTION_POLICY
SSOT.AUDIT_STORAGE_STRATEGY
SSOT.AUTHORITY_CALCULATION
SSOT.AUTHORIZATION_CACHE_TTL_SECONDS
SSOT.AlertManager
SSOT.AlertManagerPolicy
SSOT.ArchitectureResolution
SSOT.AsyncExecution
SSOT.AtomicBuffering
SSOT.Atomicity
SSOT.AuditRetentionPolicy
SSOT.AuditTypes
SSOT.BACKPRESSURE_THRESHOLD
SSOT.BNS_Dtypes
SSOT.BNS_Formats
SSOT.BNS_Validation_Spec
SSOT.BPYT_CRITICAL_THRESHOLD_PERCENT
SSOT.BPYT_WARN_THRESHOLD_PERCENT
SSOT.BP_MAX_MESSAGE_SIZE_BYTES
SSOT.BP_STATS_KEY
SSOT.BackpressureManager
SSOT.BackpressurePolicy
SSOT.BufferJanitor
SSOT.BufferRegistry
SSOT.CACHE_POLICY
SSOT.CALCULATION_LOGIC
SSOT.CATCHUP_STRATEGY
SSOT.CLIENT_VERIFICATION_POLICY
SSOT.COMMAND_SIGNER
SSOT.CONFIRMATION_CODE_REQUIREMENT
SSOT.CONFLATION_LOGIC
SSOT.CONTROL_PLANE_GATE
SSOT.CONTROL_PLANE_TIMEOUT
SSOT.CQRS_PATTERN
SSOT.CRASH_RECOVERY_SAFETY
SSOT.CheckpointPolicy
SSOT.ClOrdID
SSOT.CommandExecutor
SSOT.CommandTimeout
SSOT.CommandTypes
SSOT.CommunicationChannel
SSOT.ComponentHealth
SSOT.ComponentID
SSOT.ComputationGraph
SSOT.ConcurrencyControl
SSOT.ConfigLoader
SSOT.ContainerManagement
SSOT.ContinuityPrinciple
SSOT.ControlCommands
SSOT.DASHBOARD_PRIORITIES
SSOT.DB_PARTITIONING_POLICY
SSOT.DECIMAL_SAFETY
SSOT.DELIVERY_GUARANTEE
SSOT.DType
SSOT.DataExchangeFormat
SSOT.DecimalUtils
SSOT.DecimalValidators
SSOT.DegradationLevel
SSOT.DurabilityPolicy
SSOT.DurabilityStrategy
SSOT.ENTRYPOINT_TABLE
SSOT.ENVIRONMENT_BASELINE
SSOT.ERROR_CODES
SSOT.ERROR_CODE_4003
SSOT.ERROR_CODE_4006
SSOT.ERROR_DOMAIN_RANGES
SSOT.ERROR_RATE_THRESHOLD
SSOT.EVENT_PRIORITY_MATRIX
SSOT.EXCHANGE_API_SPEC
SSOT.EXPIRATION_CALCULATION
SSOT.EncodingPolicy
SSOT.ErrorCategories
SSOT.ErrorHandler
SSOT.ErrorHandling
SSOT.EscalationLogic
SSOT.EscalationPolicy
SSOT.EscalationThresholds
SSOT.ExchangeInterface
SSOT.FAULT_INJECTION_POLICY
SSOT.FULL_SAFE_MODE_POLICY
SSOT.FailureModePolicy
SSOT.FeatureTransport
SSOT.FileStructure
SSOT.FormatRules
SSOT.GHOST_KILL_POLICY
SSOT.GHOST_ORDER_RECOVERY
SSOT.GHOST_ORDER_SAFETY
SSOT.GRACE_PERIOD_SECONDS
SSOT.GapDetection
SSOT.Governance
SSOT.HEALTH_STATUS_VALUES
SSOT.HEARTBEAT_THRESHOLD
SSOT.HMAC_SIGNATURE
SSOT.HealthAggregator
SSOT.HealthStatus
SSOT.HealthStatusEnum
SSOT.HealthTypes
SSOT.HeartbeatInterval
SSOT.HttpSignature
SSOT.IDEMPOTENCY_POLICY
SSOT.INSTRUMENT_ID_FORMAT
SSOT.INTEGRITY_CRITERIA
SSOT.Idempotency
SSOT.IdempotencyKeys
SSOT.ImmutabilityPolicy
SSOT.ImplementationBacklog
SSOT.InfraRTT
SSOT.InfrastructureIsolation
SSOT.InitialConfig
SSOT.InstrumentID
SSOT.IntentTypes
SSOT.JANITOR_INTERVAL
SSOT.JUDGE_LOGIC
SSOT.JsonUtils
SSOT.KEY_ROTATION_PROCEDURE
SSOT.KILL_SWITCH_CONSTRAINTS
SSOT.KISS
SSOT.KernelDefinitions
SSOT.LATENCY_CRITERIA
SSOT.LATENCY_THRESHOLD
SSOT.LINUX_PID_STAT
SSOT.LOG_FORMAT_JSON
SSOT.LOST_ORDER_POLICY
SSOT.LayerHierarchy
SSOT.LocalClock
SSOT.Locks
SSOT.LoggingConfig
SSOT.MASTER_RELOAD_MECHANISM
SSOT.MEMORY_THRESHOLD
SSOT.MINIMAL_DEF
SSOT.MTLS_CONFIG
SSOT.MainRedis
SSOT.MarketData
SSOT.MessageEnvelope
SSOT.MockExchange
SSOT.ModelPathResolver
SSOT.MonitoringFrequency
SSOT.NautilusDataAdapter
SSOT.NautilusExchangeAdapter
SSOT.ORDER_VALIDATION_FLOW
SSOT.ORPHAN_ALERT
SSOT.OVERWRITE_FIELDS
SSOT.Observability
SSOT.OperationsAPI
SSOT.OrchestratorResponsibilities
SSOT.OrderTypes
SSOT.PARTITION_SCHEMA
SSOT.PHASE1_AUTH_METHOD
SSOT.PHASE_MATURITY_POLICY
SSOT.PID
SSOT.PID_CHECK
SSOT.PROCESS_ISOLATION_RULES
SSOT.PSUTIL_CREATE_TIME
SSOT.PayloadEncryption
SSOT.PerformanceOptimization
SSOT.PerformancePolicy
SSOT.PermissionMatrix
SSOT.PidRegistry
SSOT.PlaneSeparation
SSOT.PluginManual
SSOT.ProcessIndependence
SSOT.ProcessManagement
SSOT.ProcessUtils
SSOT.RBAC
SSOT.RBACMapping
SSOT.RBACPolicy
SSOT.RBAC_MATRIX
SSOT.RBAC_POLICY
SSOT.RECON_ACTIVE_PHASES
SSOT.RECON_TRIGGER_EVENTS
SSOT.REDIS_DATA_USAGE
SSOT.REDIS_KEYS
SSOT.REDIS_PUB_SUB
SSOT.REDIS_PUB_SUB_TOPICS
SSOT.REDIS_REQ_REP
SSOT.REDIS_UPDATE_STRATEGY
SSOT.RETENTION_DEFAULTS
SSOT.RETRY_POLICY
SSOT.ROLLBACK_WINDOW
SSOT.ROUND_HALF_UP
SSOT.RPC_TIMEOUT_SPEC
SSOT.RULE_STATE_SYSTEM_STATE_CANONICAL
SSOT.R_INFRA_HEALTH_STATUS_ENUM
SSOT.RecoveryPolicy
SSOT.RecoveryTimeObjective
SSOT.RedisBestPractices
SSOT.RedisDefinitions
SSOT.RedisDurability
SSOT.RedisKeyCatalog
SSOT.RedisStore
SSOT.RemovalPolicy
SSOT.ReplayPrevention
SSOT.RoleHierarchy
SSOT.RuntimeConfig
SSOT.SAFETY_HEARTBEAT_TTL_SEC
SSOT.SAFETY_PLANE
SSOT.SCORE_RANGE_VALIDATION
SSOT.SERIALIZATION
SSOT.SHA256
SSOT.SHARED_CONSTANTS
SSOT.SOURCE_OF_TRUTH
SSOT.SSE_THROTTLING_POLICY
SSOT.STARTUP_ORDER
SSOT.STORAGE_CONFIG
SSOT.STORAGE_TIERING
SSOT.SYNCING_PHASE_RECON
SSOT.SYSTEM_PHASES
SSOT.SYSTEM_STATE_DERIVATION
SSOT.SYSTEM_STATE_SCHEMA
SSOT.SYSTEM_STATUS_FLOW
SSOT.SafetyBootstrap
SSOT.SafetyCommands
SSOT.SafetyCriticalPolicy
SSOT.SafetyExchangeClient
SSOT.SafetyHeartbeat
SSOT.SafetyPriorityOrder
SSOT.SafetyRedisKeys
SSOT.SafetySettings
SSOT.SchemaIdStrict
SSOT.SecurityPolicy
SSOT.SecurityValidation
SSOT.SemVer
SSOT.SerializationFormat
SSOT.SerializationMsgPack
SSOT.ServiceLevelAgreement
SSOT.SharedConstants
SSOT.SharedInfra
SSOT.ShmCleanup
SSOT.SignalGenerator
SSOT.SignalTypes
SSOT.SignatureConfig
SSOT.SignatureMiddleware
SSOT.SignatureStability
SSOT.SigningLogic
SSOT.StateManagement
SSOT.StoragePolicy
SSOT.StreamRouter
SSOT.StructuredError
SSOT.SystemArchitecture
SSOT.SystemBootstrap
SSOT.SystemStateKeys
SSOT.TIMEOUT_HANDLER
SSOT.TIMESTAMP_NS_FORMAT
SSOT.TIMESTAMP_STANDARD
SSOT.TLS_VERSION_REQUIREMENT
SSOT.TOGGLE_DEFAULT_BEHAVIOR
SSOT.TOPICS
SSOT.TRADING_ALLOWED_STATES
SSOT.TRADING_SAFE_MODE_CONSTRAINTS
SSOT.TimeDefinitions
SSOT.TimeFormat
SSOT.TimePrecision
SSOT.TimeUtils
SSOT.Timestamp
SSOT.TracePropagation
SSOT.TypeError
SSOT.UNCONFIRMED_ORDER_RECOVERY
SSOT.UPDATE_INTERVALS
SSOT.UTC_Timestamp
SSOT.UUIDFormat
SSOT.ValidationErrors
SSOT.WALDurabilityConfig
SSOT.WAL_RETENTION_POLICY
SSOT.WAL_SSOT
SSOT.WatchdogConfig
SSOT.WatchdogLogic
SSOT.WatchdogThreshold
SSOT.WatchdogTimeout
SSOT.WatchdogTriggerConfig
SSOT.get_main_redis
```

---

## Allowed Syntax (CI-Enforced)

Definitions (ssot_definitions.ts)
- MUST include `export const SSOT_DEFINITIONS = { ... } as const;` exactly once.
- MUST NOT use `import`/`require`.
- MUST NOT contain runtime logic tokens: `function`, `class`, `new`, `if`, `for`, `while`, `switch`, `try`, `catch`, `throw`, `return`, `=>`, `async`, `await`.
- MAY export type-only declarations (`type`, `interface`, `enum`) and const data.

Runtime (ssot_runtime.ts)
- MUST import only from `./ssot_definitions` or `./ssot_definitions.ts`.
- MUST NOT re-define `SSOT_DEFINITIONS` or `SSOT_META`.
- MUST NOT declare `class`, `enum`, `namespace`, or `module`.
- MAY export functions, type-only declarations, and const helpers.

---


## Runtime Plan (What to Implement)
- Runtime exposes guards/validators/builders for definitions.
- Runtime MUST NOT add new constants or types; it imports them.
- Runtime MUST avoid I/O and side effects (pure logic only).

Checklist
- [x] Runtime exports only functions and type guards.
- [x] Runtime has no file/network I/O.
- [x] Runtime uses definitions as the single source of truth.

---

## Build/Publish Flow (L2 Integration)
1) Author/update ssot_definitions.ts and ssot_runtime.ts.
2) Run L2_builder/ssot_kernel_source_lint.py (definitions/runtime syntax).
3) Run build_ssot_definitions.py to emit OUTPUT/ssot/ssot_definitions.json + OUTPUT/ssot/ssot_registry_map.json (canonical JSON).
4) Confirm ssot_registry_map.json was regenerated (no manual edits).
5) Run L2_builder/token_registry_gen.py to generate ssot_registry.json.
6) Run L2 publish gate:
   - L2_builder/ssot_kernel_source_lint.py
   - L2_builder/ssot_kernel_lint.py
   - L2_builder/ssot_registry_consistency_check.py
   - L1_builder/token_registry_check.py (no UNRESOLVED)

Checklist
- [x] ssot_kernel_source_lint passes.
- [x] ssot_kernel_lint passes.
- [x] ssot_registry_consistency_check passes.
- [ ] token_registry_check passes with no UNRESOLVED targets.
- [ ] l2_gate_runner --publish passes.

---

## Contract Registry Generation (Adopted)
- Generate CONTRACT.* allowlist from explicit inputs + SDSL:
  - decisions/edges.yaml (contract_refs)
  - decisions/contracts.yaml (rules[].contract)
  - sdsl2/**/*.sdsl2 (contract_refs found in metadata)
- Emit OUTPUT/ssot/contract_definitions.json with token entries only (no schema bodies).
- Emit OUTPUT/ssot/contract_registry_map.json mapping:
  - CONTRACT.X -> OUTPUT/ssot/contract_definitions.json#/tokens/CONTRACT.X
- Regenerate OUTPUT/ssot/contract_registry.json via token_registry_gen.py.

Checklist
- [x] contract_definitions.json generated (schema_version/source_rev/input_hash/generator_id).
- [x] contract_registry_map.json regenerated (no manual edits).
- [x] contract_registry.json regenerated with resolved targets.

---

## Safety and Determinism
- Canonical JSON serialization MUST sort keys and keep stable array order.
- build_ssot_definitions.py MUST reject symlinks and enforce OUTPUT/ssot target.
- Registry maps MUST be inside project_root and non-symlink.

Checklist
- [x] No writes outside OUTPUT/ssot.
- [x] Deterministic JSON (same input -> same output).
- [x] source_rev uses git rev (or explicit override) and is non-empty.

---

## Continuation (Integration Completion)

Steps (Executed)
- [x] Add build step support to L2 gate runner (optional --build-ssot).
- [x] Build definitions JSON + registry map (build_ssot_definitions.py).
- [x] Generate registries (token_registry_gen.py).
- [x] Verify with ssot_kernel_lint.py and ssot_registry_consistency_check.py.
- [x] Emit input_hash/generator_id in ssot_definitions.json and ssot_registry_map.json.
- [x] Enforce input_hash/generator_id in ssot_kernel_lint.py.
- [x] Enumerate SSOT tokens from project_x/project_testing and extend ssot_definitions.ts.
- [x] CI/ops entry point: use l2_gate_runner.py --publish --build-ssot (local manual run OK).
- [x] Add ssot_kernel_source_lint.py and wire into L2 publish gate.

Steps (Remaining)
- [ ] None.

---

## Completion Design (Authority -> Definitions -> CI -> E2E)

### 1) Authority Source & Minimal Scope (Phase 0)
- Adopt the sample split (definitions/runtime) as baseline.
- Fix the minimum guaranteed domains (first release):
  - RBAC (roles, permissions, policy)
  - Redis (key patterns, ports, persistence)
  - Error Codes (registry + ranges)
  - Topics (patterns, validation rules)
  - Time/ID rules (timestamps, UUID/schema_id)
- Decide the token naming rule and the owner for each domain (SSOT only, no Contract duplication).

Checklist
- [x] Domain list fixed and approved (RBAC/Redis/Error Codes/Topics/Time-ID).
- [x] Token naming convention fixed (SSOT.<DOMAIN>_<ITEM> or SSOT.<Domain>.<Item>).
- [x] Token -> JSON pointer mapping table prepared (ssot_registry_map.json).

### 2) Fill ssot_definitions.ts (Phase 1)
- Add domain sections under SSOT_DEFINITIONS (e.g., `definitions.rbac`, `definitions.redis`, ...).
- Replace placeholder summaries with actual const data/types/enums/interfaces.
- Keep runtime logic out; only data and types.
- Update ssot_registry_map targets to point into `#/definitions/...`.

Checklist
- [x] Core domains fully defined (no placeholders).
- [x] Minimal domain definitions implemented (RBAC/Redis/Error Codes/Topics/Time-ID).
- [x] Error Codes expanded (E_300x/E_500x minimal) and Topics regex/categories added.
- [x] Error Codes expanded to cover safety/orchestration (E_1001/E_2001).
- [x] Topics regex/categories expanded (system error/strategy/execution).
- [x] Error Codes expanded across 1xxx/2xxx/3xxx/4xxx/5xxx/9xxx baseline set.
- [x] Redis key catalog expanded to include core orchestration/backpressure/statestore keys.
- [x] Registry targets resolve to real JSON pointers.
- [x] build_ssot_definitions + ssot_kernel_lint pass.

### 3) CI Publish Wiring (Phase 2)
- Enforce FAIL gates for `ssot_kernel_source`, `ssot_kernel`, `ssot_registry_consistency`.
- Publish entry point: `l2_gate_runner.py --publish --build-ssot`.
- Ensure CI uses `.sdsl/policy.yaml` as the default policy.

Checklist
- [x] CI runs publish gate with build-ssot (GitHub Actions workflow added).
- [x] No UNRESOLVED tokens in publish (project_testing, local run).

### 4) E2E Revalidation (Phase 3)
- Run L0 -> L2 with `project_testing/Test_idea.md`.
- Confirm SSOT registry and definitions are generated and consistent.
- Record any flow stalls as FINDING and refine.

Exit Criteria
- [x] L0 -> L2 completes without blocking gates (project_testing, local publish run).
- [x] ssot_registry_consistency_check passes (project_testing, local publish run).
- [x] token_registry_check passes with no UNRESOLVED (project_testing, local publish run).

---

## Implemented Tools (Python)
- ssot_kernel_builder/build_ssot_definitions.py: Build ssot_definitions.json and ssot_registry_map.json (canonical JSON, input_hash/source_rev).
- L2_builder/ssot_kernel_source_lint.py: Enforce allowed syntax for ssot_definitions.ts and ssot_runtime.ts.
- L2_builder/ssot_kernel_lint.py: Validate ssot_definitions.json schema + canonical JSON.
- L2_builder/ssot_registry_consistency_check.py: Validate ssot_registry.json targets resolve into ssot_definitions.json.
- L2_builder/contract_definitions_gen.py: Generate contract_definitions.json + contract_registry_map.json from decisions + SDSL.
- L2_builder/token_registry_gen.py: Generate ssot_registry.json + contract_registry.json from maps + SDSL usage.
- L1_builder/token_registry_check.py: Enforce registry entries are resolved (no UNRESOLVED) at publish.
- L2_builder/l2_gate_runner.py: Build/publish entry point (runs build-ssot + registry + lint gates).
- scripts/ssot_publish.py: CI/ops wrapper for l2_gate_runner with project_root/kernel_root.
- scripts/ssot_determinism_check.py: Run SSOT publish twice and compare OUTPUT/ssot hashes.

## Generated Files (Artifacts)
- OUTPUT/ssot/ssot_definitions.json: Distribution boundary JSON for SSOT definitions.
- OUTPUT/ssot/ssot_registry_map.json: SSOT token -> JSON pointer map.
- OUTPUT/ssot/ssot_registry.json: SSOT registry entries (resolved targets).
- OUTPUT/ssot/contract_definitions.json: CONTRACT token list (no schema bodies).
- OUTPUT/ssot/contract_registry_map.json: CONTRACT token -> JSON pointer map.
- OUTPUT/ssot/contract_registry.json: Contract registry entries (resolved targets).

## Next Step (Integration)
- Standardize CI entry point per project_root with --kernel-root (SSOT source) via scripts/ssot_publish.py.
- Expand minimal domain definitions toward full coverage where needed.

## Non-core Token Prioritization (Operational Impact)
Authority sources: explicit enums/consts in project_x/test_input_C_T/Contract (human-reviewed SDSL contracts).

Promotion policy
- Promote only when explicit, authoritative values exist in SDSL Contract/Topology (enum/const/struct defaults).
- Prefer minimal rule/table shapes that match those sources; avoid inferred semantics.
- Leave as kind:"ref" when source is ambiguous or design-owned.

Priority order
1) Safety/control + security/auth (commands, signatures, heartbeat settings) - in progress
2) Transport/streaming (SSE throttling, stream routing) - next
3) Durability/storage + messaging (WAL/Redis/RPC where explicit) - later
4) Domain-specific/UX/backlog (acceptance, backlog, misc) - defer

Remaining operational refs (next priority candidates, by usage/impact)
- Safety/control + auth (promoted in this pass): SSOT.SafetyCommands, SSOT.ControlCommands, SSOT.SignatureConfig, SSOT.SignatureMiddleware, SSOT.SafetySettings, SSOT.SafetyHeartbeat
- Transport/streaming (promoted in this pass): SSOT.StreamRouter, SSOT.DELIVERY_GUARANTEE, SSOT.CONFLATION_LOGIC
- Durability/storage (promoted in this pass): SSOT.WALDurabilityConfig, SSOT.STORAGE_CONFIG, SSOT.STORAGE_TIERING, SSOT.RETENTION_DEFAULTS
- Misc (defer): SSOT.ACCEPTANCE_CRITERIA, SSOT.ImplementationBacklog, SSOT.MINIMAL_DEF

Disposition rule (non-core refs)
- Promote only when explicit enum/const/default is present in Contract/Topology sources.
- Otherwise keep kind:"ref" and treat as design-owned until specified.

Completion criteria (MVP)
- [x] UNRESOLVED is zero on publish
- [x] Determinism check passes
- [x] L0â†’L2 publish path does not block (project_testing)
- [x] All non-core refs with explicit sources are promoted
- [x] Remaining non-core refs are explicitly deferred (kind:"ref" only)

Deferred refs (explicit)
- Definition: any SSOT token left as kind:"ref" in `ssot_kernel_builder/ssot_definitions.ts`
- Current count: 146
- Rule: keep as ref until an explicit Contract/Topology source is added; then promote to rule/table

---

## Gap Analysis (Current vs Ideal)
- Layout mismatch: plan mentions `definitions.<domain>` but current JSON uses top-level `tokens` and registry_map points to `/tokens/...`.
- Token naming convention is undecided (SSOT.<DOMAIN>_<ITEM> vs SSOT.<Domain>.<Item>).
- Core domains are defined; non-core tokens are partially defined with remaining refs.
- Runtime API surface is defined in ssot_runtime.ts (token helpers/validators).
- CI publish is wired via .github/workflows/ssot_kernel.yml.
- Blind/determinism tests are not defined for OUTPUT/ssot (no manifest-based check).
- Versioning policy for SSOT_META / schema_version is not documented.

## Gap Closure Plan (Ordered)
1) Decide SSOT layout: keep `tokens` root or migrate to `definitions.<domain>`.
   - If keep: align plan text and lint expectations to `/tokens/...`.
   - If migrate: define a migration plan and update registry_map targets.
2) Fix token naming convention and document it; add lint later if needed.
3) Expand domain definitions in priority order:
   - Error Codes (full set) -> Topics (categories/regex) -> Redis (catalog/TTL) -> RBAC refinements.
4) Define runtime API surface (required helpers) and add minimal checks.
5) Standardize CI entry point using `scripts/ssot_publish.py` per project_root/kernel_root.
6) Add determinism manifest for OUTPUT/ssot and run determinism_check.

Checklist
- [x] Layout decision recorded and applied (keep `tokens` root; registry_map uses `/tokens/...`).
- [x] Token naming convention documented (enforcement pending).
- [x] Domain definitions expanded beyond minimal.
- [x] Runtime API surface defined.
- [x] CI publish job wired.
- [x] Determinism check added and passing (ssot_determinism_check.py).

## Decisions (Recorded)
- SSOT layout: keep `tokens` at root (no `definitions.<domain>` grouping in v0.1).
- Token naming: do not rename legacy tokens; new tokens SHOULD use `SSOT.<DOMAIN>_<ITEM>` (UPPER_SNAKE).
