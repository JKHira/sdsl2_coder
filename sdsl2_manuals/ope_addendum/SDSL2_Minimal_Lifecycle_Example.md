# SDSL2 Minimal Lifecycle Example (L0 -> L1 -> L2)

Scope: Provide one minimal, non-normative example for the staged workflow.
Non-scope: Full schema coverage or extended edge cases.

## Definitions
- Example: Non-normative sequence of artifacts from L0 to L2.

## Rules
- This file is illustrative only; normative rules are in the referenced specs.

## Examples (Non-normative)

### Step 0: L0 Topology (Nodes Only)
```sdsl
@File {
  profile:"topology",
  id_prefix:"P0_T_EXAMPLE",
  stage:"L0",
}

@Node { id:"CONTROLLER", kind:"component" }
@Node { id:"EXECUTOR", kind:"component" }
@Node { id:"LOGGER", kind:"component" }

```

### Step 1: Intent YAML + Evidence (Non-SSOT)
```yaml
# drafts/intent/topology_example.yaml
schema_version: "1.0"
source_rev: "abc123"
input_hash: "deadbeef"
generator_id: "draft-builder/1.0.0"
scope:
  kind: "file"
  value: "sdsl2/topology/example.sdsl2"
nodes_proposed:
  - id: "CONTROLLER"
    kind: "component"
edge_intents_proposed:
  - id: "CTRL_TO_EXEC"
    from: "CONTROLLER"
    to: "EXECUTOR"
    direction: "req"
questions: []
conflicts: []
```

```yaml
# decisions/evidence.yaml
schema_version: "1.0"
source_rev: "abc123"
input_hash: "deadbeef"
scope:
  kind: "file"
  value: "sdsl2/topology/example.sdsl2"
evidence:
  CTRL_TO_EXEC:
    - source_path: "design/edges.md"
      locator: "H:Control Path#L10-L20"
      content_hash: "sha256:0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef"
      claims:
        - kind: "edge"
          decision_id: "CTRL_TO_EXEC"
        - kind: "contract_ref"
          decision_id: "CTRL_TO_EXEC"
          value: "CONTRACT.SignedControlCommand"
```

### Step 2: Explicit Inputs (Decisions)
```yaml
# decisions/edges.yaml
schema_version: "1.0"
provenance:
  author: "jdoe"
  reviewed_by: "april"
  source_link: "design/edges.md"
scope:
  kind: "file"
  value: "sdsl2/topology/example.sdsl2"
edges:
  - id: "CTRL_TO_EXEC"
    from: "CONTROLLER"
    to: "EXECUTOR"
    direction: "req"
    contract_refs:
      - "CONTRACT.SignedControlCommand"
  - id: "CTRL_TO_LOG"
    from: "CONTROLLER"
    to: "LOGGER"
    direction: "pub"
    contract_refs:
      - "CONTRACT.AuditEvent"
```

### Step 3: Promote (L0 -> L1)
Promote outputs a unified diff that inserts @Edge from Decisions and sets stage to "L1".

Resulting Topology (L1):
```sdsl
@File {
  profile:"topology",
  id_prefix:"P0_T_EXAMPLE",
  stage:"L1",
}

@Node { id:"CONTROLLER", kind:"component" }
@Node { id:"EXECUTOR", kind:"component" }
@Node { id:"LOGGER", kind:"component" }

@Edge {
  id:"CTRL_TO_EXEC",
  from:@Node.CONTROLLER,
  to:@Node.EXECUTOR,
  direction:"req",
  channel:None,
  contract_refs:[
    "CONTRACT.SignedControlCommand",
  ],
}

@Edge {
  id:"CTRL_TO_LOG",
  from:@Node.CONTROLLER,
  to:@Node.LOGGER,
  direction:"pub",
  channel:None,
  contract_refs:[
    "CONTRACT.AuditEvent",
  ],
}
```

### Step 4: Contract Decisions (Explicit Inputs)
```yaml
# decisions/contracts.yaml
schema_version: "1.0"
provenance:
  author: "jdoe"
  reviewed_by: "april"
  source_link: "design/contracts.md"
scope:
  kind: "id_prefix"
  value: "P0_C_EXAMPLE"
structures:
  - id: "SIGNED_CONTROL_COMMAND"
    decl: "struct SignedControlCommand { }"
  - id: "AUDIT_EVENT"
    decl: "struct AuditEvent { }"
rules: []
```

### Step 5: Contract Promote (Decisions -> SSOT)
contract_promote outputs a unified diff for sdsl2/contract/**/*.sdsl2 (diff-only, no auto-apply).

### Step 6: Contract Definitions (Resulting SSOT)
Note: "CONTRACT.*" tokens resolve via registry, not SDSL declarations. These are boundary schema examples only.
Registry outputs are generated by token_registry_gen.
```sdsl
@File { profile:"contract", id_prefix:"P0_C_EXAMPLE" }

@Structure { id:"SIGNED_CONTROL_COMMAND" }
struct SignedControlCommand {
  // fields
}

@Structure { id:"AUDIT_EVENT" }
struct AuditEvent {
  // fields
}
```

### Step 7: L2 (Behavioral)
- Add invariants/authz rules in Contract profile.
- Topology stage may be set to "L2" or omitted (default L2).
